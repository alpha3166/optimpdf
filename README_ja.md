# OptimPDF

1ページが1枚の画像で構成されているような画像ベースのPDFを、ハンドヘルドデバイス向けに最適化するツールです。画像ファイルのZIPをPDF化する機能も持ちます。

## サブコマンド

以下のサブコマンドを受け付けます。

### `reduce`

- PDF内の画像が、指定したサイズにぴったり収まる画素数になるよう縮小します。
- もともと指定サイズよりも小さい画像はオリジナルのサイズを保ち、拡大はしません。
- 縦長の画像はデバイスを縦置きしたときにぴったりの画素数に、横長の画像はデバイスを横置きしたときにピッタリの画素数にします。
- 指定した閾値よりも小さな画像は、デバイス上で見開き表示したときにぴったりの画素数になるよう縮小します。
- 紙焼けの色を薄くする機能も持ちます。ただし、これを使用すると薄い網の色も消えてしまうことがあります。

### `rotete`

- PDFの各ページの回転方向を、指定した角度(0、90、180、270のいずれか)に揃えます。
- 参照するPDFを指定し、そのPDFの各ページの回転方向に合わせることもできます。これは、Adobe AcrobatのOCRで回転されてしまったページを元に戻す際などに有効です。

### `unzip`

- ZIPファイルから画像ファイルだけを抽出し、1ページが1枚の画像で構成されたPDFを作成します。
- PDFが右開きになるよう指定することもできます。
- ZIP内のパスでソートした順序で出力します。

## 起動方法

1. Java (11以降) とImageMagick (6以降) をインストールします。

2. [Releaseページ](https://github.com/alpha3166/optimpdf/releases)から`optimpdf-1.0.2-jar-with-dependencies.jar`をダウンロードします。

3. コマンドラインから、サブコマンドと対象ファイルを引数に指定して、JARを実行します。

    java -jar optimpdf-1.0.2-jar-with-dependencies.jar reduce some.pdf

## 入出力の指定

### 入力ファイルの指定

- コマンドライン引数で、処理対象となる入力ファイルを指定します。
- 処理対象ファイルは複数指定することもできます。
- `-r`, `--recursive`オプションを付けると、処理対象がディレクトリならその中のファイルを再帰的に処理します。

### 出力ファイルの指定

- 何もオプションを付けなければ、入力ファイルと同じパスに処理結果を出力しようとして、上書きできずに失敗します。
- `-f`, `--force`オプションを付けると、出力ファイルがすでに存在する場合でも上書きします。
- `-o`, `--outfile`オプションで出力ファイル名を指定できます。入力ファイルが1つのときだけ使用できます。
- `-s`, `--suffix`オプションで、入力ファイル名に付加する接尾辞を指定できます。
- `-d`, `--outdir`オプションで、ファイルを出力するディレクトリを指定できます。
- `-u`, `--update`オプションを付けると、出力ファイルが存在しないか、入力ファイルが出力ファイルより新しいものだけを処理対象にします。

## コマンドラインオプション

### トップレベルのオプション

オプション|説明
-|-
-h, --help|ヘルプメッセージを表示して終了する。
-V, --version|バージョン情報を表示して終了する。

### 全サブコマンド共通のオプション

オプション|説明
-|-
-d, --outdir=_dir_|出力ファイルを _dir_ に書き込む。
-f, --force|出力ファイルを上書きする。
-h, --help|ヘルプメッセージを表示して終了する。
-l, --list|処理するファイルの一覧を表示して終了する。
-n, --dry-run|テスト実行する(出力ファイルを保存しない)。
-o, --outfile=_file_|出力を _file_ に書き出す。単一入力の場合のみ。
-q, --quiet|各ページの情報を表示しない。
-r, --recursive|再帰的に処理する。
-s, --suffix=_suffix_|入力ファイル名+_suffix_ を出力ファイル名として使用する。
-u, --update|入力が出力より新しい場合、または出力が存在しない場合のみ処理する。

### `reduce`サブコマンドのオプション

オプション|説明
-|-
-B, --bleach-pages=_pages_|指定されたページを漂白する。(例: 1,3-5 or all)
-P, --pages=_pages_|指定されたページだけを処理する。(例: 1,3-5)
-Q, --jpeg-quality=_jpegQuality_|JPEGの品質を指定する。(デフォルト: 50)
-S, --screen-size=_screenSize_|出力画面サイズを指定する。(デフォルト: 1536x2048)
-T, --number-of-threads=_numberOfThreads_|使用するスレッド数を指定する。(デフォルト: CPUコア数)
-W, --double-page-threshold=_doublePageThreshold_|見開きサイズの閾値を指定する。入力JPEGがこれ以下の場合、出力画面サイズを半分にする。(Default: 2539)

### `rotate`サブコマンドのオプション

オプション|説明
-|-
-D, --degree=_degree_|全ページの回転方向を _degree_ にする。0、90、180、270のいずれかでなければならない。(デフォルト: 0)
-R, --ref-pdf=_pdf_|各ページの回転方向を _pdf_ ファイルに合わせる。

### `unzip`サブコマンドのオプション

オプション|説明
-|-
-R, --right-to-left|右開きにする。

## ビルド方法

Git、Java (11以降)、Maven、ImageMagick (6以降) をインストールし、クローン&ビルドします。

    git clone https://github.com/alpha3166/optimpdf
    cd optimpdf
    mvn package
